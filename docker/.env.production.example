# Kura Production Environment
# Copy to .env.production and fill in values:
#   cp .env.production.example .env.production

# Database password (use a strong random value!)
# Generate with: openssl rand -hex 24
# IMPORTANT: Use hex (not base64) to avoid +/= chars that break DATABASE_URL
KURA_DB_PASSWORD=CHANGE_ME

# API key for the proxy (generated by scripts/setup-user.sh)
# The proxy injects this as Authorization header — Fred never sees the key.
KURA_API_KEY=CHANGE_ME

# Shared secret for model attestation signature verification.
# MUST be identical in gateway signer and Kura API verifier.
# Generate with: openssl rand -hex 32
KURA_AGENT_MODEL_ATTESTATION_SECRET=CHANGE_ME

# Supabase/Postgres runtime URLs (required)
# API query path
KURA_API_DATABASE_URL=postgresql://<user>:<password>@<host>:5432/postgres?sslmode=require
# Worker query path
KURA_WORKER_DATABASE_URL=postgresql://<user>:<password>@<host>:5432/postgres?sslmode=require
# Optional dedicated LISTEN/NOTIFY URL for worker
KURA_WORKER_LISTEN_DATABASE_URL=

# Public web/API routing (required)
KURA_WEB_PUBLIC_API_URL=https://api.withkura.com
# Public MCP endpoint shown in setup UI (OAuth-first MCP connector)
KURA_WEB_PUBLIC_MCP_URL=https://api.withkura.com/mcp
# Optional: set to true for verbose MCP OAuth transport/debug logs in api/src/routes/mcp_http.rs
KURA_MCP_OAUTH_DEBUG_LOGS=false

# Deterministic MCP rollout/canary guard (optional)
# Recommended for targeted rollout:
# - mode=canary
# - canary_percent=0
# - user/email allowlists populated
KURA_MCP_DETERMINISM_ROLLOUT_MODE=full
KURA_MCP_DETERMINISM_CANARY_PERCENT=10
KURA_MCP_DETERMINISM_CANARY_ALLOWLIST=
KURA_MCP_DETERMINISM_CANARY_USER_ALLOWLIST=
KURA_MCP_DETERMINISM_CANARY_EMAIL_ALLOWLIST=
KURA_MCP_DETERMINISM_ABORT_ON_BREACH=false
KURA_MCP_ROLLOUT_ABORT_OVERFLOW_RATE_MAX=0.45
KURA_MCP_ROLLOUT_ABORT_CRITICAL_MISSING_RATE_MAX=0.15
KURA_MCP_ROLLOUT_ABORT_BLOCKED_RATE_MAX=0.35
KURA_MCP_ROLLOUT_ABORT_SPECULATIVE_RATE_MAX=0.02
KURA_MCP_ROLLOUT_MIN_CONTEXT_CALLS=3
KURA_MCP_ROLLOUT_MIN_TOTAL_CALLS=10

KURA_FRONTEND_URL=https://withkura.com
KURA_CORS_ORIGINS=https://withkura.com
# Keep invite approval flow enabled in production.
SIGNUP_GATE=invite

# Supabase Auth (required for social login)
SUPABASE_URL=https://<project-ref>.supabase.co
SUPABASE_ANON_KEY=

# Cloudflare Turnstile (required for access-request + signup hardening)
# Site key is public and injected into the web build.
# Required by full deploys (scripts/deploy.sh). Core-only deploys do not build web.
KURA_TURNSTILE_SITE_KEY=
# Secret key is server-side only (API verification).
# Required for all deploy modes because API verifies Turnstile tokens server-side.
KURA_TURNSTILE_SECRET_KEY=
# Optional strict hostname check returned by Turnstile (e.g. withkura.com)
KURA_TURNSTILE_EXPECTED_HOSTNAME=

# Resend email service (for invite + password reset emails)
# Get API key from https://resend.com — domain must be verified
RESEND_API_KEY=
EMAIL_FROM="Kura <noreply@withkura.com>"
# Email to notify on new access requests
ADMIN_NOTIFY_EMAIL=

# Optional localhost bind ports for cloudflared ingress
KURA_WEB_PORT=3001
KURA_API_PUBLIC_PORT=8330

# ---------------------------------------------------------------------------
# Optional: Daily pg_dump backup to S3-compatible object storage
# Used by scripts/pgdump_s3_backup.sh
# ---------------------------------------------------------------------------

# Override DB URL for backups. If empty, script falls back to KURA_API_DATABASE_URL.
KURA_BACKUP_DATABASE_URL=

# S3-compatible destination (AWS S3, Cloudflare R2, Backblaze B2 S3 API, etc.)
BACKUP_S3_BUCKET=CHANGE_ME
BACKUP_S3_PREFIX=kura-training/postgres

# Optional custom endpoint for non-AWS S3 providers.
# Examples:
#   Cloudflare R2: https://<account-id>.r2.cloudflarestorage.com
#   Backblaze B2:  https://s3.<region>.backblazeb2.com
BACKUP_S3_ENDPOINT_URL=

# AWS-compatible credentials for the backup target.
AWS_REGION=eu-west-1
AWS_ACCESS_KEY_ID=CHANGE_ME
AWS_SECRET_ACCESS_KEY=CHANGE_ME
